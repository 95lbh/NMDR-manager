# 📅 일일 데이터 자동 초기화 테스트 가이드

## ✅ 자동 초기화 확인 완료

### 🎯 **확인된 자동 초기화 기능들**

#### 1. **출석 데이터 (Attendance)**
- ✅ **완벽하게 구현됨**
- **동작 방식**: 매일 00:00:00 ~ 23:59:59 범위의 데이터만 조회
- **구현 위치**: `src/lib/firestore.ts` - `attendanceService.getTodayAttendance()`
- **필터링 로직**:
  ```typescript
  const today = new Date();
  today.setHours(0, 0, 0, 0);
  where('date', '>=', Timestamp.fromDate(today)),
  where('date', '<', Timestamp.fromDate(new Date(today.getTime() + 24 * 60 * 60 * 1000)))
  ```

#### 2. **셔틀콕 제출 현황**
- ✅ **완벽하게 구현됨**
- **동작 방식**: 출석 데이터의 `shuttlecockCount` 필드에 포함되어 출석 데이터와 함께 자동 초기화
- **확인 방법**: 출석 데이터가 초기화되면 셔틀콕 데이터도 함께 초기화됨

#### 3. **오늘 게임 데이터**
- ✅ **완벽하게 구현됨**
- **동작 방식**: 오늘 생성된 게임만 조회
- **구현 위치**: `src/lib/firestore.ts` - `gameService.getTodayGames()`
- **필터링 로직**:
  ```typescript
  where('createdAt', '>=', Timestamp.fromDate(today)),
  where('createdAt', '<', Timestamp.fromDate(new Date(today.getTime() + 24 * 60 * 60 * 1000)))
  ```

#### 4. **진행 중인 게임 상태** 🆕
- ✅ **새로 구현됨**
- **동작 방식**: 오늘 생성된 게임 중 진행 중인 게임만 조회
- **구현 위치**: `src/lib/firestore.ts` - `gameService.getCurrentGames()`
- **필터링 로직**:
  ```typescript
  where('status', 'in', ['playing', 'waiting']),
  where('createdAt', '>=', Timestamp.fromDate(today)),
  where('createdAt', '<', Timestamp.fromDate(new Date(today.getTime() + 24 * 60 * 60 * 1000)))
  ```

### 🕛 **자정 자동 새로고침 기능**
- ✅ **새로 추가됨**
- **동작 방식**: 자정(00:00)에 자동으로 출석, 게임, 통계 데이터 새로고침
- **구현 위치**: `src/contexts/AppContext.tsx`
- **스케줄링**: `scheduleDataRefreshAtMidnight()` 함수 사용

## 🧪 테스트 방법

### 1. **개발 환경에서 즉시 테스트**
브라우저 개발자 도구 콘솔에서 다음 명령어 실행:
```javascript
// 날짜 변경 시뮬레이션 및 데이터 새로고침
testDateChange()
```

### 2. **실제 날짜 변경 테스트**
1. **오늘 데이터 생성**:
   - 출석 체크 몇 명 진행
   - 셔틀콕 제출 등록
   - 게임 시작/진행

2. **다음 날 확인**:
   - 브라우저 새로고침 또는 앱 재시작
   - 출석자 목록이 비어있는지 확인
   - 셔틀콕 현황이 초기화되었는지 확인
   - 진행 중인 게임이 없는지 확인

### 3. **시스템 시간 변경 테스트** (고급)
1. 시스템 시간을 다음 날로 변경
2. 브라우저 새로고침
3. 모든 "오늘" 데이터가 초기화되었는지 확인
4. 시스템 시간을 원래대로 복원

## 📊 **데이터 보존 vs 초기화**

### 🔄 **매일 초기화되는 데이터**
- ✅ 오늘 출석자 목록
- ✅ 오늘 셔틀콕 제출 현황
- ✅ 오늘 진행 중인 게임
- ✅ 오늘 대기 중인 게임

### 💾 **영구 보존되는 데이터**
- ✅ 회원 정보
- ✅ 완료된 게임 기록 (통계용)
- ✅ 과거 출석 기록 (통계용)
- ✅ 코트 설정

## 🚀 **운영 환경에서의 동작**

### **자동 동작**
1. **자정 자동 새로고침**: 매일 00:00에 자동으로 데이터 새로고침
2. **브라우저 새로고침**: 언제든지 새로고침하면 오늘 데이터만 로드
3. **앱 재시작**: 앱을 다시 시작하면 오늘 데이터만 로드

### **수동 확인**
- 관리자가 매일 아침 첫 접속 시 모든 데이터가 초기화되었는지 확인
- 문제 발생 시 브라우저 새로고침으로 해결 가능

## ⚠️ **주의사항**

1. **Firebase 인덱스**: 날짜 기반 쿼리를 위한 복합 인덱스가 필요할 수 있음
2. **시간대**: 서버와 클라이언트의 시간대가 다를 경우 고려 필요
3. **캐시**: 브라우저 캐시로 인해 이전 데이터가 보일 수 있음 (새로고침으로 해결)

## ✨ **결론**

**모든 일일 데이터가 자동으로 초기화되도록 완벽하게 구현되었습니다!**

- 📅 날짜가 바뀌면 자동으로 오늘 데이터만 표시
- 🕛 자정에 자동 새로고침 스케줄링
- 🧪 개발 환경에서 테스트 가능
- 💾 중요한 데이터는 영구 보존
- 🔄 임시 데이터는 매일 초기화
